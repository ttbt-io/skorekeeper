services:
  chrome:
    container_name: "chrome-screenshots"
    image: "chromedp/headless-shell:141.0.7390.37"
    user: "65534:65534"
    shm_size: "2gb"
    command: [
      "--ignore-certificate-errors",
      "--disable-gpu",
      "--disable-dev-shm-usage",
      "--window-size=1280x800",
      "--disable-popup-blocking",
    ]
    healthcheck:
      test: ["CMD", "true"]
      interval: 5s
      retries: 5
      start_period: 5s
    volumes:
      - type: tmpfs
        target: /nonexistent
        tmpfs:
          size: 10M
          mode: 0o777

  generator:
    container_name: "screenshot-generator"
    image: "skorekeeper-screenshots"
    user: "${TEST_UID:-1000}:${TEST_GID:-1000}"
    command: ["--chrome-url=ws://chrome:9222", "--output-dir=/screenshots"]
    volumes:
      - ../../www/assets/manual:/screenshots
      - type: tmpfs
        target: /data
        tmpfs:
          size: 100M
          mode: 0o1777
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 100M
          mode: 0o1777
    networks:
      default:
        aliases:
          - devtest.local
    depends_on:
      chrome:
        condition: service_healthy

networks:
  default:
    internal: true
